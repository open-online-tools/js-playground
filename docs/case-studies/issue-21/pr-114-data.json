{
  "additions": 615,
  "author": {
    "id": "MDQ6VXNlcjE0MzE5MDQ=",
    "is_bot": false,
    "login": "konard",
    "name": "Konstantin Diachenko"
  },
  "body": "## Summary\n\nThis PR enhances the release scripts to support both single-language and multi-language repository structures by adding automatic package root detection.\n\n**New utility modules:**\n- `scripts/js-paths.mjs` - JavaScript package root detection\n- `scripts/rust-paths.mjs` - Rust package root detection\n\n**Updated scripts:**\n- `scripts/version-and-commit.mjs`\n- `scripts/instant-version-bump.mjs`\n- `scripts/publish-to-npm.mjs`\n- `scripts/rust-version-and-commit.mjs`\n- `scripts/rust-collect-changelog.mjs`\n- `scripts/rust-get-bump-type.mjs`\n\n## How It Works\n\nThe utilities automatically detect the package root:\n\n1. **Single-language repository**: Check for `./package.json` or `./Cargo.toml` in root\n2. **Multi-language repository**: Check for `./js/package.json` or `./rust/Cargo.toml`\n3. If neither exists, throw an error with helpful suggestions\n\n### Configuration Options\n\nScripts support explicit configuration via:\n- CLI arguments: `--js-root <path>` or `--rust-root <path>`\n- Environment variables: `JS_ROOT` or `RUST_ROOT`\n\n### Example Usage\n\n```bash\n# Auto-detection (default)\nnode scripts/version-and-commit.mjs --mode changeset\n\n# Explicit configuration\nnode scripts/version-and-commit.mjs --mode changeset --js-root js\n\n# Via environment variable\nJS_ROOT=js node scripts/version-and-commit.mjs --mode changeset\n```\n\n## Root Cause (Original Issue)\n\nThe original issue (#113) was that `command-stream` library's `cd` command calls `process.chdir()`, which permanently changes the working directory. This caused file operations to fail after running commands like `cd js && npm run ...`.\n\nThis PR addresses the issue comprehensively by:\n1. âœ… Preserving and restoring the working directory after `cd` commands (previous fix)\n2. âœ… Adding auto-detection of package root to support both repo structures (this enhancement)\n\n## Test Plan\n\n- [x] Verified syntax check passes for all modified scripts\n- [x] Tested `js-paths.mjs` utility - correctly detects `js/` as package root\n- [x] Tested `rust-paths.mjs` utility - correctly detects `rust/` as package root\n- [ ] Verify CI pipeline passes\n- [ ] Manual test in a single-language repository (optional)\n\nFixes #113\n\n---\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)",
  "commits": [
    {
      "authoredDate": "2026-01-10T22:42:05Z",
      "authors": [
        {
          "email": "drakonard@gmail.com",
          "id": "MDQ6VXNlcjE0MzE5MDQ=",
          "login": "konard",
          "name": "konard"
        }
      ],
      "committedDate": "2026-01-10T22:42:05Z",
      "messageBody": "Adding CLAUDE.md with task information for AI processing.\nThis file will be removed when the task is complete.\n\nIssue: https://github.com/link-assistant/agent/issues/113",
      "messageHeadline": "Initial commit with task details",
      "oid": "43e241ab09e1ac47e3abba0b1f3235ee6b33c130"
    },
    {
      "authoredDate": "2026-01-10T22:49:32Z",
      "authors": [
        {
          "email": "drakonard@gmail.com",
          "id": "MDQ6VXNlcjE0MzE5MDQ=",
          "login": "konard",
          "name": "konard"
        },
        {
          "email": "noreply@anthropic.com",
          "id": "MDQ6VXNlcjgxODQ3",
          "login": "claude",
          "name": "Claude Opus 4.5"
        }
      ],
      "committedDate": "2026-01-10T22:49:32Z",
      "messageBody": "The command-stream library's cd command is a virtual command that\ncalls process.chdir(), permanently changing the Node.js process's\nworking directory. This caused release scripts to fail when trying\nto read ./js/package.json after running cd js && npm run ...\n\nRoot cause: After `cd js && npm run changeset:version` completed,\nthe process was still in the js/ directory, so reading\n./js/package.json tried to access js/js/package.json which doesn't\nexist.\n\nFixed by saving the original cwd before cd commands and restoring\nit after each command that changes directory.\n\nAlso fixed publish-to-npm.mjs which was missing the cd js prefix\nfor npm run changeset:publish (the script is in js/package.json).\n\nFixes #113\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
      "messageHeadline": "fix: Restore working directory after cd commands in release scripts",
      "oid": "583f7cce33ffeecc7e0d1ebeba7ef86e4911e674"
    },
    {
      "authoredDate": "2026-01-10T22:52:49Z",
      "authors": [
        {
          "email": "drakonard@gmail.com",
          "id": "MDQ6VXNlcjE0MzE5MDQ=",
          "login": "konard",
          "name": "konard"
        }
      ],
      "committedDate": "2026-01-10T22:52:49Z",
      "messageBody": "This reverts commit 43e241ab09e1ac47e3abba0b1f3235ee6b33c130.",
      "messageHeadline": "Revert \"Initial commit with task details\"",
      "oid": "cc35a3720bca86104d66849ef31f725a3093e9ab"
    },
    {
      "authoredDate": "2026-01-10T23:04:45Z",
      "authors": [
        {
          "email": "drakonard@gmail.com",
          "id": "MDQ6VXNlcjE0MzE5MDQ=",
          "login": "konard",
          "name": "konard"
        },
        {
          "email": "noreply@anthropic.com",
          "id": "MDQ6VXNlcjgxODQ3",
          "login": "claude",
          "name": "Claude Opus 4.5"
        }
      ],
      "committedDate": "2026-01-10T23:04:45Z",
      "messageBody": "Add js-paths.mjs and rust-paths.mjs utilities that automatically detect\nthe package root for both single-language and multi-language repositories:\n\n- Check for ./package.json or ./Cargo.toml first (single-language repo)\n- If not found, check ./js/ or ./rust/ subfolder (multi-language repo)\n- Support explicit configuration via --js-root/--rust-root CLI options\n- Support environment variables JS_ROOT and RUST_ROOT\n\nUpdated scripts to use the shared utilities:\n- version-and-commit.mjs\n- instant-version-bump.mjs\n- publish-to-npm.mjs\n- rust-version-and-commit.mjs\n- rust-collect-changelog.mjs\n- rust-get-bump-type.mjs\n\nThis makes the scripts work seamlessly in both single-language repositories\n(where package.json/Cargo.toml is in the root) and multi-language repositories\n(where they are in js/ and rust/ subfolders).\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>",
      "messageHeadline": "feat: Add configurable package root for release scripts",
      "oid": "b4b1d66d59b6d563ed1d8395917b575974e692d0"
    }
  ],
  "createdAt": "2026-01-10T22:42:12Z",
  "deletions": 30,
  "files": [
    {
      "path": "docs/case-studies/issue-113/README.md",
      "additions": 111,
      "deletions": 0
    },
    {
      "path": "scripts/instant-version-bump.mjs",
      "additions": 38,
      "deletions": 5
    },
    { "path": "scripts/js-paths.mjs", "additions": 159, "deletions": 0 },
    { "path": "scripts/publish-to-npm.mjs", "additions": 41, "deletions": 8 },
    {
      "path": "scripts/rust-collect-changelog.mjs",
      "additions": 25,
      "deletions": 4
    },
    {
      "path": "scripts/rust-get-bump-type.mjs",
      "additions": 12,
      "deletions": 1
    },
    { "path": "scripts/rust-paths.mjs", "additions": 169, "deletions": 0 },
    {
      "path": "scripts/rust-version-and-commit.mjs",
      "additions": 17,
      "deletions": 4
    },
    {
      "path": "scripts/version-and-commit.mjs",
      "additions": 43,
      "deletions": 8
    }
  ],
  "mergedAt": "2026-01-10T23:07:46Z",
  "number": 114,
  "state": "MERGED",
  "title": "feat: Add configurable package root for release scripts",
  "url": "https://github.com/link-assistant/agent/pull/114"
}
